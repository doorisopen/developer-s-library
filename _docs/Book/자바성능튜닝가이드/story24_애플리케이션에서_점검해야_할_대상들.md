# story24. 애플리케이션에서 점검해야 할 대상들
생성일: 2022년 7월 10일 오후 10:13

# 패턴과 아키텍처의 구성

- **너무 많은 패턴을 사용하지 않았는가?**
    - 너무많은 패턴을 적용하면 유지보수성이 떨어지고 문제가 발생했을 때 추적하기가 어려워진다.
- **데이터를 리턴할 때 TO(혹은 VO) 패턴을 사용하였는가? 아니면 Collection 관련 클래스를 사용하였는가?**
    - 데이터 리턴과 관련된 표준을 정하지 않으면 추후 시스템의 응답 시간 뿐 아니라 유지 보수성이 떨어질 수 있어서 표준을 정하는 것이 좋다.
- **서비스 로케이터(Service Locator)패턴은 적용이 되어 있는가?**
    - 해당 패턴을 사용하면 애플리케이션에서 필요한 대상을 찾는 룩업(Lookup) 작업을 할 때 소요되는 대기 시간을 줄일 수 있다.

# 기본 코딩 규칙

- **네이밍 규칙**
    - 의미 있는 변수, 메소드 네이밍 설정하기
- **필요한 부분의 예외 처리**
- **예외 화면 지정**
    - 예외 화면을 지정하지 않으면 사용자에게 서버의 정보를 노출할 수 있어서 예외 화면을 지정해줘야한다.
- **예외 정보를 어떻게 처리하는가**
    - 예외 정보를 e.printStackTrace()로 처리하게되면 스택 정보를 취합하여야 하기 때문에 서버에 많은 부하가 발생할 수 있다.
- **System.gc() 포함 여부 확인(사용 금지)**
- **System.exit() 포함 여부 확인(사용 금지)**
- **문자열을 계속 더하도록 코딩하지 말 것**
    - String 클래스는 문자열을 더할 수 록 새로운 객체를 생성한다.
    - 때문에 GC 발생이 빈번해 질 수 있다.
    - JDK 5.0 이상을 사용하면 자동으로 StringBuilder 클래스로 변환해주기는 하지만, 루프를 수행하면서 문자열을 더할 경우에는 컴파일러도 어떨 수가 없으니 필요에 따라 StringBuilder나 StringBuffer 클래스를 사용한다.
- **StringBuilder나 StringBuffer 클래스를 제대로 사용하기**
    - 문자열을 더해야한다고 할 때, sb.append(”hello” + “world”) 이와 같이 사용하면 위 클래스들을 사용하는 이유가 없으니 sb.append(”hello”).append(“world”) 다음과 같이 사용한다.
- **무한 루프 코드 확인**
    - while(true) 와 같은 구문이 사용되는 곳이 있는지 확인해본다.
- **static 남발한 사용**
    - 메모리를 아끼기 위해 static을 남발하게 되면 시스템이 심각한 오류를 발생시킬 수 있다.
- **적절한 synchronized 블록 사용**
    - 필요하지 않는 부분에서 synchronized 블록을 사용하면 성능 저하를 발생시킬 수 있다.
- **IO가 계속 발생하도록 개발된 부분이 있는지 확인**
    - 설정 파일을 매번 파일에서 읽도록 개발하는 것을 유의해야한다.
    - IO가 매번 발생하기 때문에 자원을 낭비하게 된다.
- **불필요한 로그는 제거하기**
- **System.out.println 제거하기**

# 웹 관련 코딩

- JSP의 include는 필요한 부분에서만 동적으로 설정하고 그외는 정적으로 설정해야한다.
    - 동적으로 설정하면 서버에 부하를 줄 수 있고 응답 시간에도 영향을 준다.
- 자바 빈즈를 너무 많이 사용하지 말아야한다.
    - 하나의 TO(VO)를 사용하여 자바 빈즈를 사용해서 응답 시간에 영향을 주는 부분을 최소화한다.
- 태그 라이브러리 사용 자제
    - 많은 양의 데이터를 태그 라이브러리로 처리할 경우 성능에 많은 영향을 끼친다.
- EJB의 적절한 사용
    - 필요한 경우에만 EJB를 사용한다.
- 이미지 서버를 사용할 수 있는 환경 구성
    - 이미지, JS, CSS, 플래시 등 정적 컨텐츠를 이미지 서버를 활용하여 처리하는 것이 효율적이다.
- 검증된 프레임워크 사용하기

# DB 관련 코딩

- 적절한 JDBC 드라이버 사용
    - 가장 최신의 WAS 및 DB 벤더에서 추천하는 JDBC 사용
- DB Connection, Statement, ResultSet 자원 해제 close()
- DB Connection Pool 사용하기
    - DB의 리소스를 보다 효율적으로 사용할 수 있다.
- auto commit
    - 기본은 자동 커밋이지만 때에 따라 필요하지 않는 경우가 있으니 적절하게 설정이 필요하다.
- ResultSet.last() 사용 자제
    - 전체 건수를 처리하기 위해서 last()를 사용하면 데이터가 많은 경우 응답 시간이 느려질 수 있다.
- PreparedStatement 사용 권장
    - Statement를 사용하면 쿼리 수행할 때 마다 SQL 쿼리를 컴파일하게 된다. 이 작업은 DB에 많은 부하를 준다. 그러므로 쿼리 문장이 계속 동적으로 변경되어야 하는 경우를 제외하면 PreparedStatements를 사용하는 것을 권장한다.

# 서버 설정

- 자바 VM 관련 옵션 설정하기
    - 64비트 기반의 시스템에서 -d64 옵션을 사용하지 않으면 32 비트로 시스템이 운영된다.
    - 클래스 패스(class path)는 순차적으로 인식되기 때문에 여러 JAR 파일 중 동일한 패키지명의 클래스가 존재할 경우 앞에 명시한 클래스 패스에 우선권이 있다.
- 메모리 설정
    - 서버는 기본 64MB로 시작
- GC 설정
    - -client로 설정되어 있는지 확인해보기
- 서버 환경(운영, 개발) 확인하기
- WAS 인스턴스가 몇 개 기동되고 있는지 확인
    - WAS에서 하나의 인스턴스당 적어도 한 개는 있어야 제대로된 운영이 가능하다.
    - CPU는 4개인데, 인스턴스가 30개 정도 있는 것은 아닌지 확인한다.
- JSP Precompile 옵션 지정
    - 서버를 기동할 때 JSP를 미리 컴파일하도록 하면 사용자는 JSP가 수정되었는지 여부와 상관없이 일정한 응답 속도를 느낄 수 있다.
    - 서버 기동 시 시간도 많이 소요될 수 있어 상황에 맞게 설정하는 것이 중요하다.
- DB Connection Pool 개수와 스레드 개수는 적절한지 확인
    - 스레드 개수가 DBCP의 수보다 절대로 적어서는 안된다.
    - 스레드 개수는 DBCP 보다 10개 정도 더 많이 설정한다.
- 세션 타임아웃 시간 설정
- 검색 서버가 있는 경우, 검색 서버 설정 및 성능 테스트 여부 확인

# 모니터링

- 웹 로그는 반드시 남기자
- verbosegc 옵션으로 로그를 남기자
- 각종 로그 파일에 대한 규칙을 설정하자
- 서버의 시스템 사용률 로그를 남기자
    - WAS나 DB가 얼마나 사용하고 있는지 로그를 남겨야한다.
    - 유닉스의 vmstat나 sar 명령어를 사용하면 시간대별 서버 사용량을 구할 수 있다.
- 모니터링 툴을 사용하자(+ 적절한 설정)
- 서버의 코어 덤프 발생 여부 확인
    - 10,000건 이상 조회하는 것이 있는지 확인
        - 한번에 많은 양의 데이터를 처리하려면 많은 메모리가 필요한데, 이 때 코어덤프가 발생할 수 있다. 데이터 처리를 위한 메모리보다 지정된 메모리 크기가 적을 수 있기 때문이다.
    - 메모리 릭이 있는지 확인
        - 메모리를 점유하고 해제하지 않는 로직을 확인해서 처리한다.