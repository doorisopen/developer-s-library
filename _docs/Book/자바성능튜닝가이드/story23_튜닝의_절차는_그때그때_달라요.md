# story23. 튜닝의 절차는 그때그때 달라요
생성일: 2022년 7월 10일 오후 10:12

# 성능 튜닝

1. 원인 파악
2. 목표 설정
3. 튜닝 실시
4. 개선율 확인
5. 결과 정리 및 반영

## 원인 파악

- 성능 저하가 발생하는 원인 파악하는 단계
- 어디가 병목인지 확실히 파악하여 원인을 찾아야 한다.

## 목표 설정

- 성능 튜닝의 목표를 설정하는 단계
- 향후 유지보수까지 모두 고려하여 목표를 설정하는 것이 좋다.

## 튜닝 실시

- 코드를 최적화하며 튜닝하는 단계
- 프로파일링 툴이나 APM과 같은 툴을 사용하는 것이 좋다.
- 개선율이 궁금하다면 JMH이나 캘리퍼와 같은 성능 비교 도구를 사용하는 것도 좋다.

## 개선율 확인

- 튜닝을 실시한 후 얼마나 개선되었는지를 확인하는 단계
- 결과가 만족스럽지 않은 경우에 상황에 따라 ‘원인 파악’ 혹은 ‘튜닝 실시’ 단계로 다시 돌아간다.

## 결과 정리 및 반영

- 튜닝한 결과들을 정리하고 실제 운영되는 시스템에 반영하는 단계
- 결과를 정리하는 가장 좋은 방법은 파워 포인트나 워드같은 문서지만, 많은 시간이 소요된다.
    - 관련자들에게 메일 혹은 사내 위키에 정리하는 것도 좋다.

# 성능 튜닝 비법

1. 하나만 보지 말아라.
2. 큰 놈을 없애라.
3. 깊게 알아야 한다. 
4. 결과 공유는 선택이 아닌 필수다.

## 하나만 보지 말아라.

- 과거의 경험을 토대로 그 부분만을 보지 말고 전체를 봐야한다.
- 성능상 문제를 발생 시킬 수 있는 대상은 아주 많다.

**성능 문제 발생 주요 대상**

| 대상 | 세부 대상 |
| --- | --- |
| 서버 장비 | CPU, Network, Disk, Memory 등 |
|  서버 OS | OS 커널, OS 설정, 수행중인 프로세스 등 |
| 자바 애플리케이션 | 스레드 풀 설정, DB Connection Pool 설정, Cache 설정, GC 설정, Heap 크기 설정, 검증되지 않은 프레임워크의 버그, 개발된 애플리케이션 등 |
|  웹 서버 | 프로세스 개수 설정, Connector 설정, 개발된 모듈의 버그 등 |
| 네트워크 | 사용자의 네트워크 종류, 사용자의 위치, L4 및 Switch 등 네트워크 장비, 방화벽 등 |
| 클라이언트 | 클라이언트 장비의 CPU, Network, Disk, Memory, OS 등의 성능, 클라이언트 애플리케이션, 클라이언트 장비에서 수행 중인 프로세스 등 |

## 큰 놈을 없애라.

- 효율이 적은 부분 보다는 문제가 큰 부분을 개선하는 것이 효과적이다.
- 부하 테스트 툴이나 간단히 스레드를 만들어서 부하를 주어 성능을 측정해보는 것이 좋다.
- 라이브러리에 문제가 발생한 경우
    - 라이브러리를 튜닝, 교체하는 방법이 있다.
- 시스템의 코어 개발이 완료되었을때 성능 테스트를 통해 사용중인 라이브러리의 성능을 검증하는 것이 좋다.
- 클라이언트의 성능도 브라우저의 개발자 도구를 통해 어떻게 로딩되는지 확인해보는 것도 좋다.

## 깊게 알아야 한다.

- 개발 언어, OS, DB, N/W, 서버 등 대충 알면 대충 튜닝할 수 밖에 없다.
- 모든 것의 전문가가 되기는 어렵지만 최대한의 공부를 통해 최적의 값을 찾아내는 노력이 필요하다.

## 결과 공유는 선택이 아닌 필수다.

결과 정리 시 꼭 포함되어야 하는 내용

- **개요:** 튜닝을 실시한 배경
- **튜닝 환경:** 튜닝을 실시하고 성능을 측적한 서버 및 툴에 대한 상세한 내용
- **튜닝 결과:** 튜닝 전과 후의 결과를 비교
    - 확실한 결과 위주로 포함하는 것이 좋다
        - 기존 대비 얼마나 성능 개선이 이루어졌는지를 수치로 보여주는 것이 좋다.
    - 개선 효과가 가장 큰 것 부터 나열한다.
- **결론:** 어느 부분을 어떻게 변경하는 것이 가장 큰 효과를 줄지, 튜닝 작업을 진행한 담당자의 의견 등을 포함